<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Track URL</title>
    <%- include("../admin/layout/head.ejs") %>
    <link rel="stylesheet" href="/static/css/responsive-table.css">
    <!-- <link rel="stylesheet" href="/static/css/googleapisicon/main.css"> -->
    <link rel="stylesheet" href="/static/css/stylekeytrack.css">
    <!-- <link rel="stylesheet" href="//stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.css"> -->
    <!-- <link rel="stylesheet" href="/static/css/font-awesome-4.7.0/css/font-awesome.css"> -->
    <script src="/static/theme/vendor/jquery/axios-0.21.1.min.js"></script>
    <script src="/static/js/services/keytrackreq.js"></script>
    <script src="/static/js/services/fillindextrack.js"></script>
<!-- < % if (data && data.user && data.user.tokennotify==null) { %> -->
    <!-- <script src="/static/notification/web-push.js"></script> -->
<!-- < % } %> -->
</head>
<body>
    <div class="container">
        <%- include("../admin/layout/nav.ejs") %>
        <div class="row" style="margin-bottom:10px; ">
            <div class="col-md-12">
                <a href="/track/new" class="btn btn-success pull-right">Thêm mới URL</a>
            </div>
        </div>

        <div class="panel panel-default" id="panel-body">
            <div class="panel-heading text-center" style="word-wrap: break-word;">
                <div class="row">
                    <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12  text-center" style="margin-top: 5px;"><b>Danh sách URL</b></div>
                    <div class="col-lg-9 col-md-9 col-sm-9 col-xs-12">
                    <% if (data && data.trackper==1) { %>
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                            <select class="form-control input-sm text-center" id="list-users" style="margin-bottom: 5px;">
                                <option value="0" selected>Người dùng (Tất cả)</option>
                        <% if (data && data.trackper==1 && data.listUser && data.listUser.length>0) { %>
                            <% for (var i= 0 ; i < data.listUser.length; i++) { %>
                                <option value="<%= data.listUser[i].last_name %>"><%= data.listUser[i].last_name %> (<%= data.listUser[i].email %>)</option>
                            <% } %>
                        <% } %>
                            </select>
                        </div>
                    <% } %>
                        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">
                            <select class="form-control input-sm text-center" id="list-checked">
                                <option value="" selected>Trạng thái URL (Tất cả)</option>
                                <option value="1">Đã duyệt</option>
                                <option value="0">Chưa duyệt</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div class="panel-body" style="overflow: auto;">
                <% if (data && data.error){ %>
                    <div id="login-alert" class="alert alert-danger col-sm-12" style="text-align:center">
                        <%= data.error %>
                    </div>
                <%}%>
                    <div>
                        <table class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Danh sách URL</th>
                                    <th>Tiêu đề</th>
                                    <th>URL chuyển hướng</th>
                                    <th>Khác</th>
                                    <th>Tương tác</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% if (data && data.postsip){%>
                                    <% for (var i= data.postsip.length-1; i > -1; i--) { %>
                                    <tr <% if (data&&data.postsip[i]&&data.postsip[i].bgimg){%>
                                        style="background-image: url('<%- data.postsip[i].bgimg %>');
                                               background-size: cover;
                                               background-repeat: no-repeat;
                                               background-position: center center;" 
                                        <%}%>>
                                        <td data-label="Danh sách URL" class="custom-td" style ="text-align: left; overflow: auto; max-height: 300px;"> 
                                            <p><b>Phân tích: </b><a href="/data/<%= data.postsip[i].title %>">Kết quả TrackURL</a> ==> URL: </p> 
                                            <p><b>1a.</b><a class="urlserver">/profile.php?id=<%=data.postsip[i].title %></a></p>
                                            <p><b>1b.</b><a class="urlserverausername" number="num-<%-i%>">/profile.php?id=<%=data.postsip[i].title %></a></p>
                                            <p><b>2a.</b><a class="urlserver">/permalink.php?story_fbid=<%=data.postsip[i].title %></a></p>
                                            <p><b>2b.</b><a class="urlserverausername" number="num-<%-i%>">/permalink.php?story_fbid=<%=data.postsip[i].title %></a></p>
                                            <p><b>3a.</b><a class="urlserver">/watch?v=<%=data.postsip[i].title %></a></p>
                                            <p><b>3b.</b><a class="urlserverausername" number="num-<%-i%>">/watch?v=<%=data.postsip[i].title %></a></p>
                                            <p><b>4a.</b><a class="urlserver">/id=<%=data.postsip[i].title %></a></p>
                                            <p><b>4b.</b><a class="urlserverausername" number="num-<%-i%>">/id=<%=data.postsip[i].title %></a></p>
                                            <p><b>5a.</b><a class="urlserver">/posts=<%=data.postsip[i].title %></a></p>
                                            <p><b>5b.</b><a class="urlserverausername" number="num-<%-i%>">/posts=<%=data.postsip[i].title %></a></p>
                                            
                                        </td>
                                        <td data-label="Tiêu đề" class="custom-td" style = "overflow: auto; max-height: 300px;"><p><%- data.postsip[i].titleval %></p></td>
                                        <td data-label="URL chuyển hướng" class="custom-td" id="url-render" number="num-<%-i%>" key="<%- data.postsip[i].link %>"><%- data.postsip[i].link %></td>
                                        <td data-label="Khác" class="custom-td">
                                            <p><b>Tọa độ: </b><% if (data.postsip[i].check_geo==0) {%>Không<% } else { %>Có<% } %></p>
                                            <p><b>Máy ảnh: </b><% if (data.postsip[i].check_img==0) {%>Không<% } else { %>Có<% } %></p>
                                        </td>
                                        <td style="display: none;" class="name-user-list-url" id="<%= data.postsip[i].id %>" user-id="<% if (data && data.trackper==1) { %><%= data.postsip[i].name_user %><% } else{ %>0<% } %>"  status-id="<% if (data && data.postsip[i].admin_check==1) { %>1<% } else { %>0<% } %>" iduser="<% if (data && data.trackper==1) { %><%= data.postsip[i].id_user %><% } else{ %><% } %>">checked Filler</td>
                                    <% if (data && data.trackper==1) { %>
                                        <td data-label="Tương tác" class="custom-td">
                                            <p><b>Tài khoản: </b><%= data.postsip[i].name_user %></p>
                                            <input type="checkbox" style="width: 36px; height:36px;" class="admin_check" name="admin_check" id="admin_check-<%= data.postsip[i].id %>" value=<%= data.postsip[i].admin_check %> <% if (data && data.postsip[i].admin_check==1) { %>checked<% } %> >
                                            <br>
                                            <p><b>Thời gian: </b><%= data.postsip[i].created_at %></p>
                                            <button href="/track/delete" class="btn btn-danger post_delete" post_id="<%= data.postsip[i].id %>" post_title="<%= data.postsip[i].title %>">Xóa</button>
                                        </td>
                                    <% } else { %>
                                        <td data-label="Tương tác" class="custom-td">
                                            <% if (data && data.postsip[i].admin_check==1) { %>
                                                <b style='color: rgb(9, 199, 41);'>Đã duyệt</b>
                                            <% } else { %>
                                                <b style='color: rgb(209, 3, 54);'>Chưa duyệt (Liên hệ Quản trị)</b>
                                            <% } %>
                                            <br>
                                            <p><b>Thời gian: </b><%= data.postsip[i].created_at %></p>
                                            <button href="/track/delete" class="btn btn-danger post_delete" post_id="<%= data.postsip[i].id %>" post_title="<%= data.postsip[i].title %>">Xóa</button>      
                                        </td>
                                    <% } %>
                                    </tr>
                                    <% } %>
                                <% } %>  

                            </tbody>
                        </table>
                    </div>
            </div>
        </div>
        <h4 style="word-wrap: break-word;"><b>API công khai: </b><a class="urlserver">/track/api</a></h4>
        <!-- ==============================add key box============================== -->
        <% if (data && data.trackper==1){%>
            <div id="body">
                <div id="chat-circle" class="btn btn-raised">
                    <div id="chat-overlay" style="z-index: 1;"></div>
                        <svg height="25px" width="25px" class="w-[40px] h-[40px] text-gray-800 dark:text-white" aria-hidden="true" fill="currentColor" viewBox="4 4 15 20">
                            <path fill-rule="evenodd" d="M17 10v1.1l1 .5.8-.8 1.4 1.4-.8.8.5 1H21v2h-1.1l-.5 1 .8.8-1.4 1.4-.8-.8a4 4 0 0 1-1 .5V20h-2v-1.1a4 4 0 0 1-1-.5l-.8.8-1.4-1.4.8-.8a4 4 0 0 1-.5-1H11v-2h1.1l.5-1-.8-.8 1.4-1.4.8.8a4 4 0 0 1 1-.5V10h2Zm.4 3.6c.4.4.6.8.6 1.4a2 2 0 0 1-3.4 1.4A2 2 0 0 1 16 13c.5 0 1 .2 1.4.6ZM5 8a4 4 0 1 1 8 .7 7 7 0 0 0-3.3 3.2A4 4 0 0 1 5 8Zm4.3 5H7a4 4 0 0 0-4 4v1c0 1.1.9 2 2 2h6.1a7 7 0 0 1-1.8-7Z" clip-rule="evenodd"/>
                        </svg>                               
                    </div>
                <div class="chat-box">
                    <div class="chat-box-header">
                        <span class="msg-avatar avatar-chats-header"> <img src="/static/imgs/admin-settings-male.png" width="30px" height="30px"></span>
                        <div style="float: left; padding-top: 5px; padding-left: 5px;">Từ khóa</div>
                        <span class="chat-box-toggle">
                            <svg height="30px" width="30px" class="w-[40px] h-[40px] text-gray-800 dark:text-white" aria-hidden="true" fill="none" viewBox="0 0 24 24">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 18 6m0 12L6 6"/>
                            </svg>
                        </span>
                    </div>
                    <div class="chat-box-body">
                        <div class="chat-box-overlay"></div>
                        <div class="chat-logs">
                            <ul id="list-key-track" class="mainbox list-key-track">
                                <% if (data && data.dataKeyReq){%>
                                    <% for (var i= data.dataKeyReq.length-1; i > -1; i--) { %>
                                        <li class="key-track" id ="key-track-<%=data.dataKeyReq[i].id %>" name="key-track-<%=data.dataKeyReq[i].id %>" ><%=data.dataKeyReq[i].keyreq %><button key-id-del="key-track-<%=data.dataKeyReq[i].id %>" class="delete-keytrack"><svg style="color: rgb(250, 64, 64);" height="15px" width="15px" aria-hidden="true" fill="none" viewBox="0 0 20 20"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 18 6m0 12L6 6"/></svg></button></li>
                                    <% } %>
                                <% } %>
                            </ul>
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="chat-input" class="form-control input add-input" style="border-radius: 0 0 5px 5px;" placeholder="Thêm từ khóa Request HTTP" autocomplete="off" maxlength=49 />
                        <button class="chat-submit add-submit" id="add-submit" style="margin-right: 10px;">
                            <svg height="30px" width="30px" class="w-[30px] h-[30px] text-gray-800 dark:text-white" aria-hidden="true" fill="currentColor" viewBox="0 0 24 24">
                                <path fill-rule="evenodd" d="M4.9 3C3.9 3 3 3.8 3 4.9V9c0 1 .8 1.9 1.9 1.9H9c1 0 1.9-.8 1.9-1.9V5c0-1-.8-1.9-1.9-1.9H5Zm10 0c-1 0-1.9.8-1.9 1.9V9c0 1 .8 1.9 1.9 1.9H19c1 0 1.9-.8 1.9-1.9V5c0-1-.8-1.9-1.9-1.9h-4Zm-10 10c-1 0-1.9.8-1.9 1.9V19c0 1 .8 1.9 1.9 1.9H9c1 0 1.9-.8 1.9-1.9v-4c0-1-.8-1.9-1.9-1.9H5ZM18 14a1 1 0 1 0-2 0v2h-2a1 1 0 1 0 0 2h2v2a1 1 0 1 0 2 0v-2h2a1 1 0 1 0 0-2h-2v-2Z" clip-rule="evenodd"/>
                            </svg>                            
                        </button>
                    </div>
                </div>

            </div>
        <% } %>
    </div> 
    <script type="text/javascript" src="/static/js/postip.js"></script>
</body>
</html>